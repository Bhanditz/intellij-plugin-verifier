buildscript {

  ext.kotlin_version = '1.0.5'

  repositories {
    jcenter()
  }
  dependencies {
    classpath 'com.github.jengelman.gradle.plugins:shadow:1.2.3'
    classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.6'
    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
  }
}

def extractorVersion = '1.0'
def intellijStructureVersion = '1.36'
def verifierVersion = '1.54'

configure(allprojects) {
  apply plugin: 'java'
  apply plugin: 'kotlin'
  apply plugin: 'maven-publish'

  version = extractorVersion
  group = 'org.jetbrains.intellij.plugins'

  dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"
  }

  sourceCompatibility = 1.6
  targetCompatibility = 1.6

  repositories {
    mavenCentral()
    mavenLocal()
    maven { url "http://dl.bintray.com/jetbrains/intellij-plugin-service" }
    maven { url "http://www.jetbrains.com/intellij-repository/releases" }
  }
}

dependencies {
  compile(group: 'org.jetbrains.intellij.plugins', name: 'intellij-plugin-structure', version: intellijStructureVersion, ext: 'jar', classifier: 'all')
  compile group: 'org.jetbrains.intellij.plugins', name: 'verifier-results', version: verifierVersion
  compile group: 'com.google.guava', name: 'guava', version: '19.0'
  compile group: 'org.slf4j', name: 'slf4j-api', version: '1.7.21'
  compile group: 'commons-io', name: 'commons-io', version: '2.5'
  compile group: 'commons-io', name: 'commons-io', version: '2.5'

  testCompile group: 'junit', name: 'junit', version: '4.11'
  testCompile project(':test-classes')
}

task sourcesJar(type: org.gradle.api.tasks.bundling.Jar) {
  classifier = 'sources'
  from sourceSets.main.allSource
}

artifacts.archives sourcesJar

publishing {

  publications {

    def configurePublication = { org.gradle.api.publish.maven.MavenPublication pub ->

      pub.groupId group
      pub.artifactId name
      pub.version version

      pub.from components.java
      artifacts
      pub.artifact sourcesJar
    }

    ProjectPublication(org.gradle.api.publish.maven.MavenPublication) { configurePublication(it) }
  }
}

publishToMavenLocal.dependsOn test

/*
Previously this artifact was dependent on the IDEA distribution.

ext.ideaDevVersion = '163.7743.44'
ext.ideaCorePath = file("$buildDir/download/ideaCore")

configurations {
  ideaDependency
}

dependencies {
  ideaDependency group: 'com.jetbrains.intellij.idea', name: 'ideaIU', version: ideaDevVersion, ext: 'zip'
  compile files("${ideaCorePath}/lib/openapi.jar", "${ideaCorePath}/lib/idea.jar", "${ideaCorePath}/lib/util.jar")
}

task extractIdeaCore {
  ext.fromFile = { configurations.ideaDependency.files.first() }
  ext.toDir = ideaCorePath
  inputs.file fromFile
  outputs.dir toDir

  doLast {
    delete ideaCorePath
    copy {
      from zipTree(fromFile)
      into ideaCorePath
    }
  }
}

compileKotlin.dependsOn(extractIdeaCore)
compileJava.dependsOn(extractIdeaCore)
*/