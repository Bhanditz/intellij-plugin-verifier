buildscript {
  ext {
    kotlin_version = '1.1.4'
    ext.verifierVersion = '1.103'
  }
  repositories {
    jcenter()
    mavenLocal()
    mavenCentral()
  }
  dependencies {
    classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.6'
    classpath 'com.github.jengelman.gradle.plugins:shadow:1.2.3'
    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
  }
}

def serviceVersion = project.hasProperty('myVersion') ? project.myVersion : '1.0'

configure(allprojects) {
  version = serviceVersion
  group "org.jetbrains.intellij.plugins.verifier"

  apply plugin: "war"
  apply plugin: 'kotlin'
  apply plugin: 'idea'
  apply plugin: 'java'

  idea {
    module {
      inheritOutputDirs = false
      outputDir = file("$buildDir/classes/main")
    }
  }

  war {
    manifest {
      attributes 'Plugin-Verifier-Service-Version': version
    }
  }


  repositories {
    mavenLocal()
    mavenCentral()
    maven { url "http://dl.bintray.com/jetbrains/intellij-plugin-service" }
  }

  dependencies {
    testCompile 'junit:junit:4.12'
    compile "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"
    compile group: 'commons-io', name: 'commons-io', version: '2.5'
    compile 'com.github.salomonbrys.kotson:kotson:2.4.0'
    compile 'com.google.code.gson:gson:2.7'

    compile 'com.squareup.retrofit2:retrofit:2.1.0'
    compile 'com.squareup.retrofit2:converter-gson:2.1.0'
    compile 'com.squareup.okhttp3:logging-interceptor:3.3.1'

    compile group: 'org.slf4j', name: 'slf4j-api', version: '1.7.24'
    compile group: 'ch.qos.logback', name: 'logback-classic', version: '1.1.7'
    runtime "org.codehaus.groovy:groovy:2.4.12"

    compile "commons-fileupload:commons-fileupload:1.3.1"

    compile group: 'org.jetbrains.intellij.plugins', name: 'intellij-feature-extractor', version: '1.0'
    compile group: 'org.jetbrains.intellij.plugins', name: 'verifier-core', version: rootProject.verifierVersion

    compile group: 'javax.servlet', name: 'javax.servlet-api', version: '3.1.0'
  }

}

apply plugin: 'maven-publish'

publishToMavenLocal.dependsOn test
